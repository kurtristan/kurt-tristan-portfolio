<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Content Manager - Kurt Tristan</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238A9A8E' stroke-width='2'%3E%3Cpath d='m8 3 4 8 5-5 5 15H2L8 3z'/%3E%3C/svg%3E" type="image/svg+xml">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f5f5; color: #2c2c2c; }
    .admin-header { background: #8A9A8E; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
    .admin-header h1 { font-size: 1.5rem; font-weight: 700; }
    .admin-header .subtitle { font-size: 0.9rem; opacity: 0.8; }
    .admin-container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
    .admin-tabs { display: flex; gap: .5rem; margin-bottom: 2rem; }
    .tab-button { padding: 1rem 2rem; background: white; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; font-weight: 500; transition: all .3s; }
    .tab-button.active { background: #8A9A8E; color: white; border-color: #8A9A8E; }
    .tab-button:hover { border-color: #8A9A8E; }
    .tab-content { display: none; background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,.1); }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; margin-bottom: .5rem; font-weight: 600; color: #2c2c2c; }
    .form-group input, .form-group textarea { width: 100%; padding: 1rem; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; transition: border-color .3s; }
    .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #8A9A8E; }
    .form-group textarea { resize: vertical; min-height: 120px; }
    .btn { padding: 1rem 2rem; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all .3s; text-decoration: none; display: inline-block; }
    .btn-primary { background: #8A9A8E; color: white; }
    .btn-primary:hover { background: #6B7A6F; transform: translateY(-2px); }
    .btn-secondary { background: #F5F1E8; color: #2c2c2c; border: 2px solid #ddd; }
    .btn-secondary:hover { border-color: #8A9A8E; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-danger:hover { background: #c82333; }
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .gallery-card { background: #f9f9f9; border-radius: 10px; padding: 1rem; border: 2px solid #ddd; display: flex; flex-direction: column; gap: .5rem; }
    .gallery-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; }
    .journal-entries { margin-bottom: 2rem; display: grid; gap: 1rem; }
    .journal-card { background: #F5F1E8; border-radius: 10px; padding: 1.5rem; border: 2px solid #ddd; }
    .journal-card h3 { margin-bottom: .5rem; color: #2c2c2c; }
    .journal-card .date { color: #8A9A8E; font-weight: 500; margin-bottom: 1rem; }
    .journal-card .content { color: #666; line-height: 1.6; white-space: pre-wrap; }
    .upload-area { border: 3px dashed #8A9A8E; border-radius: 10px; padding: 3rem; text-align: center; margin-bottom: 1rem; transition: all .3s; cursor: pointer; }
    .upload-area:hover { background: rgba(138,154,142,.1); }
    .upload-area.dragover { background: rgba(138,154,142,.2); border-color: #6B7A6F; }
    .message { padding: 1rem; border-radius: 10px; margin-bottom: 1rem; }
    .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #8A9A8E; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (max-width: 768px) {
      .admin-container { padding: 0 1rem; }
      .admin-tabs { flex-direction: column; }
      .gallery-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="admin-interface">
    <div class="admin-header">
      <div>
        <h1>Kurt Tristan - Admin Panel</h1>
        <div class="subtitle">Manage your photography portfolio</div>
      </div>
      <div>
        <button class="btn btn-primary" onclick="updateWebsite()" id="update-btn">üöÄ Update Website</button>
        <a href="/" class="btn btn-secondary">View Website</a>
      </div>
    </div>

    <div class="admin-container">
      <div class="admin-tabs">
        <div class="tab-button active" onclick="showTab('gallery', this)">üì∏ Gallery Manager</div>
        <div class="tab-button" onclick="showTab('journal', this)">‚úçÔ∏è Journal Manager</div>
      </div>

      <!-- Gallery -->
      <div id="gallery-tab" class="tab-content active">
        <!-- gallery code unchanged -->
      </div>

      <!-- Journal -->
      <div id="journal-tab" class="tab-content">
        <h2>Journal Manager</h2>
        <p>Write and manage your journal entries</p>
        <div id="journal-messages"></div>
        <h3>Current Entries</h3>
        <div class="journal-entries" id="current-journal">
          <div class="loading"></div>
        </div>
        <h3>Write New Entry</h3>
        <div class="form-group">
          <label for="entry-title">Entry Title</label>
          <input type="text" id="entry-title" placeholder="Enter title...">
        </div>
        <div class="form-group">
          <label for="entry-date">Entry Date</label>
          <input type="date" id="entry-date">
        </div>
        <div class="form-group">
          <label for="entry-content">Entry Content</label>
          <textarea id="entry-content" placeholder="Write your journal entry here..."></textarea>
        </div>
        <button class="btn btn-primary" onclick="addJournalEntry()" id="journal-btn">Add Journal Entry</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/.netlify/functions';
    let galleryData = [];
    let journalData = [];
    let droppedFile = null;

    const showMessage = (containerId, message, type) => {
      const box = document.getElementById(containerId);
      box.innerHTML = `<div class="message ${type}">${message}</div>`;
      setTimeout(() => { box.innerHTML = ''; }, 5000);
    };

    const setLoading = (buttonId, loading) => {
      const btn = document.getElementById(buttonId);
      if (!btn) return;
      if (loading) {
        btn.disabled = true;
        btn.dataset.originalText = btn.dataset.originalText || btn.innerHTML;
        btn.innerHTML = '<span class="loading"></span> Loading...';
      } else {
        btn.disabled = false;
        btn.innerHTML = btn.dataset.originalText || 'Done';
      }
    };

    // ... gallery code unchanged ...

    // ---------- Journal ----------
    async function loadJournal() {
      const box = document.getElementById('current-journal');
      try {
        let res = await fetch(`${API_BASE}/journal`);
        if (!res.ok) {
          res = await fetch(`${API_BASE}/journal`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'list' })
          });
        }
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        journalData = await res.json();
        renderJournal();
      } catch (err) {
        console.error(err);
        box.innerHTML = '<p style="color:#c00">Failed to load journal.</p>';
        showMessage('journal-messages', 'Error loading journal.', 'error');
      }
    }

    function renderJournal() {
      const box = document.getElementById('current-journal');
      box.innerHTML = '';
      if (!Array.isArray(journalData) || journalData.length === 0) {
        box.innerHTML = '<p>No journal entries yet.</p>';
        return;
      }
      journalData.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'journal-card';
        const h3 = document.createElement('h3');
        h3.textContent = entry.title || 'Untitled';
        const dateEl = document.createElement('div');
        dateEl.className = 'date';
        dateEl.textContent = entry.entry_date || entry.date || '';
        const contentEl = document.createElement('div');
        contentEl.className = 'content';
        contentEl.textContent = entry.content || '';
        card.appendChild(h3);
        card.appendChild(dateEl);
        card.appendChild(contentEl);
        box.appendChild(card);
      });
    }

    async function addJournalEntry() {
      const title = document.getElementById('entry-title').value.trim();
      const date = document.getElementById('entry-date').value;
      const content = document.getElementById('entry-content').value.trim();
      if (!title || !date || !content) {
        showMessage('journal-messages', 'Please provide title, date, and content.', 'error');
        return;
      }
      setLoading('journal-btn', true);
      try {
        const res = await fetch(`${API_BASE}/journal`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content, entry_date: date }) // ‚úÖ fixed
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        document.getElementById('entry-title').value = '';
        document.getElementById('entry-date').value = '';
        document.getElementById('entry-content').value = '';
        showMessage('journal-messages', 'Entry added.', 'success');
        await loadJournal();
      } catch (err) {
        console.error(err);
        showMessage('journal-messages', 'Failed to add entry.', 'error');
      } finally {
        setLoading('journal-btn', false);
      }
    }

    // ---------- Init ----------
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('button').forEach(btn => { btn.dataset.originalText = btn.innerHTML; });
      loadGallery();
      loadJournal();
    });
  </script>
</body>
</html>
